<!DOCTYPE html>
<html>
<head lang="zh-CN">
    <meta charset="UTF-8">
    <title>抽奖 - 拍我网</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <style>
    .tabbable td{ outline: none;height: 24px}
	.film{
		position: absolute;
		width: 200px;
		height: 200px;
		transform:translate3d(0,0,0);
		opacity: 0;
		-webkit-transform: translate3d(0, 0, 0);
		transform: translate3d(0, 0, 0);
		margin: 160px 0px 0px 122px;
	}
	
	.film.step1{
		-webkit-transform: translate3d(400px, 0px, 0px);
		transform: translate3d(400px, 0px, 0px);
		opacity: 1;
		-webkit-transition: all 2000ms cubic-bezier(0.215, 0.610, 0.355, 1.000);
		transition: all 2000ms cubic-bezier(0.215, 0.610, 0.355, 1.000);
		
	}

/*
	.film.step2{
		-webkit-transform: translate3d(400px, -80px, 0px);
		transform: translate3d(400px, -80px, 0px);
		-webkit-transition: all 2000ms cubic-bezier(.53,.47,.31,.93);
		transition: all 2000ms cubic-bezier(.53,.47,.31,.93);
		opacity: 1;
		
	}
*/
		
	.file_box{
		position: absolute;
		width: 100%;
		height: 100%;
/*		border: 1px solid #ccc;*/
		text-align: center;
	}
	
	.file_box .avatar{
		border-radius: 50%;
		width: 80px;
		height: 80px;
		margin-top: 18px;
        
	}
		
	.file_box .name{
		display: inline-block;
		width: 180px;
		height: 40px;
		line-height: 40px;
		margin: 6px 0;
		text-align: center;
		font-size: 20px;
        overflow: hidden;
        white-space:nowrap;
        max-width: 140px;
	}
		
	.file_box .number{
		display: inline-block;
		width: 100px;
		height: 30px;
		line-height: 30px;
		text-align: center;
		font-size: 18px;
		font-style: normal;
	}
    #next{
        display: none;
    }
	
		
@-webkit-keyframes shake-slow {
	0% {
		-webkit-transform: translate(0px, 0px) rotate(0deg);
	}
	2% {
		-webkit-transform: translate(-1px, 3px) rotate(-1.5deg);
	}
	4% {
		-webkit-transform: translate(-4px, 5px) rotate(-1.5deg);
	}
	6% {
		-webkit-transform: translate(-1px, 6px) rotate(-0.5deg);
	}
	8% {
		-webkit-transform: translate(5px, -4px) rotate(-3.5deg);
	}
	10% {
		-webkit-transform: translate(-7px, -3px) rotate(-3.5deg);
	}
	12% {
		-webkit-transform: translate(-1px, 8px) rotate(2.5deg);
	}
	14% {
		-webkit-transform: translate(3px, -5px) rotate(-1.5deg);
	}
	16% {
		-webkit-transform: translate(1px, 0px) rotate(2.5deg);
	}
	18% {
		-webkit-transform: translate(-6px, -10px) rotate(-0.5deg);
	}
	20% {
		-webkit-transform: translate(3px, -2px) rotate(1.5deg);
	}
	22% {
		-webkit-transform: translate(0px, 0px) rotate(-2.5deg);
	}
	24% {
		-webkit-transform: translate(-5px, -4px) rotate(1.5deg);
	}
	26% {
		-webkit-transform: translate(-1px, 3px) rotate(-3.5deg);
	}
	28% {
		-webkit-transform: translate(1px, 1px) rotate(-3.5deg);
	}
	30% {
		-webkit-transform: translate(-4px, 8px) rotate(1.5deg);
	}
	32% {
		-webkit-transform: translate(-9px, 7px) rotate(-3.5deg);
	}
	34% {
		-webkit-transform: translate(4px, -9px) rotate(-2.5deg);
	}
	36% {
		-webkit-transform: translate(1px, -6px) rotate(-2.5deg);
	}
	38% {
		-webkit-transform: translate(-4px, 0px) rotate(-2.5deg);
	}
	40% {
		-webkit-transform: translate(3px, -7px) rotate(0.5deg);
	}
	42% {
		-webkit-transform: translate(4px, 4px) rotate(-0.5deg);
	}
	44% {
		-webkit-transform: translate(8px, -4px) rotate(-2.5deg);
	}
	46% {
		-webkit-transform: translate(9px, 9px) rotate(-3.5deg);
	}
	48% {
		-webkit-transform: translate(6px, -8px) rotate(-0.5deg);
	}
	50% {
		-webkit-transform: translate(-1px, 4px) rotate(-3.5deg);
	}
	52% {
		-webkit-transform: translate(4px, 6px) rotate(-1.5deg);
	}
	54% {
		-webkit-transform: translate(9px, -3px) rotate(2.5deg);
	}
	56% {
		-webkit-transform: translate(8px, -2px) rotate(-3.5deg);
	}
	58% {
		-webkit-transform: translate(-2px, -9px) rotate(-0.5deg);
	}
	60% {
		-webkit-transform: translate(-1px, -5px) rotate(2.5deg);
	}
	62% {
		-webkit-transform: translate(-8px, 3px) rotate(2.5deg);
	}
	64% {
		-webkit-transform: translate(6px, -2px) rotate(-3.5deg);
	}
	66% {
		-webkit-transform: translate(-5px, 9px) rotate(-1.5deg);
	}
	68% {
		-webkit-transform: translate(3px, 1px) rotate(-0.5deg);
	}
	70% {
		-webkit-transform: translate(6px, 4px) rotate(-1.5deg);
	}
	72% {
		-webkit-transform: translate(-6px, -5px) rotate(1.5deg);
	}
	74% {
		-webkit-transform: translate(-8px, 0px) rotate(-0.5deg);
	}
	76% {
		-webkit-transform: translate(-5px, -8px) rotate(1.5deg);
	}
	78% {
		-webkit-transform: translate(5px, -3px) rotate(-1.5deg);
	}
	80% {
		-webkit-transform: translate(-6px, -3px) rotate(-1.5deg);
	}
	82% {
		-webkit-transform: translate(7px, 8px) rotate(-1.5deg);
	}
	84% {
		-webkit-transform: translate(-6px, 9px) rotate(0.5deg);
	}
	86% {
		-webkit-transform: translate(1px, 8px) rotate(-3.5deg);
	}
	88% {
		-webkit-transform: translate(-9px, -2px) rotate(1.5deg);
	}
	90% {
		-webkit-transform: translate(4px, -6px) rotate(-1.5deg);
	}
	92% {
		-webkit-transform: translate(0px, -1px) rotate(0.5deg);
	}
	94% {
		-webkit-transform: translate(2px, -9px) rotate(2.5deg);
	}
	96% {
		-webkit-transform: translate(-9px, 1px) rotate(-2.5deg);
	}
	98% {
		-webkit-transform: translate(-9px, -5px) rotate(-3.5deg);
	}
}
		
		@keyframes shake-slow {
	0% {
		-webkit-transform: translate(0px, 0px) rotate(0deg);
	}
	2% {
		-webkit-transform: translate(-1px, 3px) rotate(-1.5deg);
	}
	4% {
		-webkit-transform: translate(-4px, 5px) rotate(-1.5deg);
	}
	6% {
		-webkit-transform: translate(-1px, 6px) rotate(-0.5deg);
	}
	8% {
		-webkit-transform: translate(5px, -4px) rotate(-3.5deg);
	}
	10% {
		-webkit-transform: translate(-7px, -3px) rotate(-3.5deg);
	}
	12% {
		-webkit-transform: translate(-1px, 8px) rotate(2.5deg);
	}
	14% {
		-webkit-transform: translate(3px, -5px) rotate(-1.5deg);
	}
	16% {
		-webkit-transform: translate(1px, 0px) rotate(2.5deg);
	}
	18% {
		-webkit-transform: translate(-6px, -10px) rotate(-0.5deg);
	}
	20% {
		-webkit-transform: translate(3px, -2px) rotate(1.5deg);
	}
	22% {
		-webkit-transform: translate(0px, 0px) rotate(-2.5deg);
	}
	24% {
		-webkit-transform: translate(-5px, -4px) rotate(1.5deg);
	}
	26% {
		-webkit-transform: translate(-1px, 3px) rotate(-3.5deg);
	}
	28% {
		-webkit-transform: translate(1px, 1px) rotate(-3.5deg);
	}
	30% {
		-webkit-transform: translate(-4px, 8px) rotate(1.5deg);
	}
	32% {
		-webkit-transform: translate(-9px, 7px) rotate(-3.5deg);
	}
	34% {
		-webkit-transform: translate(4px, -9px) rotate(-2.5deg);
	}
	36% {
		-webkit-transform: translate(1px, -6px) rotate(-2.5deg);
	}
	38% {
		-webkit-transform: translate(-4px, 0px) rotate(-2.5deg);
	}
	40% {
		-webkit-transform: translate(3px, -7px) rotate(0.5deg);
	}
	42% {
		-webkit-transform: translate(4px, 4px) rotate(-0.5deg);
	}
	44% {
		-webkit-transform: translate(8px, -4px) rotate(-2.5deg);
	}
	46% {
		-webkit-transform: translate(9px, 9px) rotate(-3.5deg);
	}
	48% {
		-webkit-transform: translate(6px, -8px) rotate(-0.5deg);
	}
	50% {
		-webkit-transform: translate(-1px, 4px) rotate(-3.5deg);
	}
	52% {
		-webkit-transform: translate(4px, 6px) rotate(-1.5deg);
	}
	54% {
		-webkit-transform: translate(9px, -3px) rotate(2.5deg);
	}
	56% {
		-webkit-transform: translate(8px, -2px) rotate(-3.5deg);
	}
	58% {
		-webkit-transform: translate(-2px, -9px) rotate(-0.5deg);
	}
	60% {
		-webkit-transform: translate(-1px, -5px) rotate(2.5deg);
	}
	62% {
		-webkit-transform: translate(-8px, 3px) rotate(2.5deg);
	}
	64% {
		-webkit-transform: translate(6px, -2px) rotate(-3.5deg);
	}
	66% {
		-webkit-transform: translate(-5px, 9px) rotate(-1.5deg);
	}
	68% {
		-webkit-transform: translate(3px, 1px) rotate(-0.5deg);
	}
	70% {
		-webkit-transform: translate(6px, 4px) rotate(-1.5deg);
	}
	72% {
		-webkit-transform: translate(-6px, -5px) rotate(1.5deg);
	}
	74% {
		-webkit-transform: translate(-8px, 0px) rotate(-0.5deg);
	}
	76% {
		-webkit-transform: translate(-5px, -8px) rotate(1.5deg);
	}
	78% {
		-webkit-transform: translate(5px, -3px) rotate(-1.5deg);
	}
	80% {
		-webkit-transform: translate(-6px, -3px) rotate(-1.5deg);
	}
	82% {
		-webkit-transform: translate(7px, 8px) rotate(-1.5deg);
	}
	84% {
		-webkit-transform: translate(-6px, 9px) rotate(0.5deg);
	}
	86% {
		-webkit-transform: translate(1px, 8px) rotate(-3.5deg);
	}
	88% {
		-webkit-transform: translate(-9px, -2px) rotate(1.5deg);
	}
	90% {
		-webkit-transform: translate(4px, -6px) rotate(-1.5deg);
	}
	92% {
		-webkit-transform: translate(0px, -1px) rotate(0.5deg);
	}
	94% {
		-webkit-transform: translate(2px, -9px) rotate(2.5deg);
	}
	96% {
		-webkit-transform: translate(-9px, 1px) rotate(-2.5deg);
	}
	98% {
		-webkit-transform: translate(-9px, -5px) rotate(-3.5deg);
	}
}
		
	#camera{
		margin-top: 40px;
	}
	#camera.shake-slow {
		-webkit-animation-name: shake-slow;
		-ms-animation-name: shake-slow;
		animation-name: shake-slow;
		-webkit-animation-duration: 5s;
		-ms-animation-duration: 5s;
		animation-duration: 5s;
		-webkit-animation-iteration-count: infinite;
		-ms-animation-iteration-count: infinite;
		animation-iteration-count: infinite;
		-webkit-animation-timing-function: ease-in-out;
		-ms-animation-timing-function: ease-in-out;
		animation-timing-function: ease-in-out;
		-webkit-animation-delay: 0s;
		-ms-animation-delay: 0s;
		animation-delay: 0s;
		-webkit-animation-play-state: running;
		-ms-animation-play-state: running;
		animation-play-state: running;
	}
    </style>
</head>
<body>
<div class="container-fluid">
	<div class="row-fluid">
		<div class="span12">
		  
			<h3 class="text-center">
                    &nbsp;
			</h3>      
			<h3 class="text-center">
				SIGMA - 拍我网
			</h3>
		</div>
	</div>
	<div class="row-fluid">
		<div class="span12">
		
		
            
		<div class="tabbable" id="tabs-524434">
				<ul class="nav nav-tabs">
					<li class="active">
						<a href="#panel-3547" data-toggle="tab">签到登记</a>
					</li>
					<li>
						<a href="#panel-833365" data-toggle="tab">抽奖</a>
					</li>
				</ul>
				<div class="tab-content">
					<div class="tab-pane active" id="panel-3547">
                    <h2>人员签到</h2>
                
			        
			        <a href="#myModal" role="button" class="btn" data-toggle="modal">添加新人员</a>
                     
            <table class="table" id="table">
				<thead>
					<tr>
						<th>
							编号
						</th>
						<th>
							摄影师
						</th>
						<th>
							签到
						</th>
						<th>
							抽取镜头
						</th>
					</tr>
				</thead>
				
				<tbody id="add_menu">
					
					
					
				</tbody>
			</table>
                
                
                
					</div>
					<div class="tab-pane" id="panel-833365">
                           <div class="span3" id="photo_film">
                             <div class="film">
                             	<div class="file_box">
                             		<img src="" alt="" class="avatar" />
                             		<span class="name"></span>
                             		<i class="number"></i>
                             	</div>
                             	<img class="film_img" width="200" src="/static/images/film.png" alt="">
                             </div>
                             <button class="btn" type="button" id="jt">开始抽取镜头</button>

                              <button class="btn" type="button" id="gz">开始抽取公仔</button>
                              <button class="btn btn-primary" id="next">下一位</button>
                                             
                             <img id="camera" alt="140x140" src="/static/images/photo.jpg">     
                        
                           </div>
                            <div class="span5">
                           
                               
                                
                            </div>
                         
                          <div class="span2">
                                <h3>
                                  镜头中奖名单 
                                   
                               </h3>
                                 <table class="table">
                                    <thead>
                                        <tr>
                                            <th>
                                                编号
                                            </th>
                                            <th>
                                                摄影师
                                            </th>

                                        </tr>
                                    </thead>
                                    <tbody id="prize_show">
                                        
                        

                                    </tbody>
                                </table>    
		                 </div>
		                 
                        <div class="span2">
                               <h3>
                                  公仔中奖名单 
                                   
                               </h3>
                            <table class="table">
                                    <thead>
                                        <tr>
                                            <th>
                                                编号
                                            </th>
                                            <th>
                                                摄影师
                                            </th>

                                        </tr>
                                    </thead>
                                    <tbody id="prize_show2">
                                       

                                    </tbody>
                                </table>    
                            
                            
                        </div>  
					</div>
				</div>
			</div>
		
		
		
			
			
		</div>
	</div>
</div>
    
    
    <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel" class="text-center">添加新人员</h3>
  </div>
  
  
  <div class="modal-body">
            <form>
				<fieldset>
					 <legend>个人信息</legend> <label>昵称/姓名</label><input type="text" id="add-name"/>
				</fieldset>
			</form>    
  </div>
  
  
  
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
    <button class="btn btn-primary" data-dismiss="modal"  id="confirm-add">确定</button>
  </div>
</div>
    
    <script src="/static/js/com/jquery-1.8.3.min.js"></script>
    <script src="/static/js/com/bootstrap.js"></script>
    <script>
        var num = 0;
        var pdata = [];
        var index = 0;
        var luck_type = 0;
        var main2 = $('#photo_film');

       
        
    $(function(){
        
      
        var main = $('#table'),
			next = $('#next');
			
        
        $('#confirm-add').on('click', function(){
            num++;
            var tm = '';
            var val = $('#add-name').val();
            tm += '<tr><td>'+num+'</td><td contentEditable="true">'+val+
                    '</td><td><button class="btn btn-primary btn-mini">否</button>'+
                '</td><td><button class="btn btn-mini jin">否</button></td></tr>';
         
            $('#add_menu').append(tm);
            addPeople(num, val);
        });
        
        //签到
        main.on('click', '.btn-primary', function(){
            var t = $(this);
            //t.removeClass('btn-primary').html('是').addClass('btn-success');
             var id = t.parents('tr').addClass('success').find('td').eq(0).html();
            t.replaceWith('<i class="icon-ok"></i>');
            isCome(id);
            
        });
        
        //微博抽取镜头
        main.on('click', '.jin', function(){
             var t = $(this);
             var p = $(this).parents('tr');
             if(p.find('.icon-ok').length ==0){
                return; 
             }
            var id = p.find('td').eq(0).html();
            isWeibo(id);
            t.replaceWith('<i class="icon-ok"></i>');
             //t.removeClass('jin').html('是').addClass('btn-info');
            
        });
        
		
		//抽奖下一位
		next.on('click',function(){

			showHead(pdata[index]);
            
            index++;
            
            $('#camera').addClass('shake-slow');
			setTimeout(function(){
				setTimeout(function(){
					$('#camera').removeClass('shake-slow');
					$('.film').addClass('step1');
				},100);
			},800);
			
			
		});
        
         main2.on('click', '#jt', function(){
             this.id = 'jt2';
            luck_type = 1;
            $.ajax({
                  url:'/a/lucky/get_lucky',
                  type:'POST',
                  dataType:'json',
                  async: false,
                  data: {lucky_type: '1',
                         lucky_count: '13'}, 
                
                  success:function(data){
                      if(data.error_id ==0){

                         pdata = data.result.user_list.sort(function(a, b){ return (0.5 - Math.random())})
                          filterName2(pdata);
                          index = 0;
                           $('#next').show();
                           $('#next').trigger('click');
                      }
                  }
                });
        
        });
        main2.on('click', '#gz', function(){
            this.id = 'gz2';
            
            luck_type = 2;
             $.ajax({
                  url:'/a/lucky/get_lucky',
                  type:'POST',
                  dataType:'json',
                  async: false,
                  data: {lucky_type: '2',
                         lucky_count: '5'},     
                  success:function(data){
                      if(data.error_id ==0){
                       
                          pdata = data.result.user_list.sort(function(a, b){ return (0.5 - Math.random())})
                            filterName2(pdata);
                          index = 0;
                           $('#next').show();
                           $('#next').trigger('click');

                      
                      }
                  }
                });
        
        });
		
    
    
    });
        
        
    function addPeople(id,name){
         $.ajax({
          url:'/a/lucky/user_add',
          type:'POST',
          dataType:'json',
          async:false,
          data: {user_id: id, weibo_nickname:name},
          success:function(data){
           
            }
        });
    }
    
    function editPeople(id, name){
        $.ajax({
          url:'/a/lucky/user_edit',
          type:'POST',
          dataType:'json',
          async:false,
          data: {user_id: id, weibo_nickname:name},
          success:function(data){
           
            }
        });
        
    
    }
        
function init(){
    $.ajax({
      url:'/a/lucky/user_init',
      type:'POST',
      dataType:'json',
      async:false,
      success:function(data){
        if(data.error_id == 0){
           showadd(data.result.user_list );

        }
      }
    });
}  
init();  

function isCome(id){
     $.ajax({
      url:'/a/lucky/user_signin',
      type:'POST',
      dataType:'json',
      async: false,
      data: {user_id: id},     
      success:function(data){
       
      }
    });
}
        
function isWeibo(id){
 $.ajax({
      url:'/a/lucky/user_weibo',
      type:'POST',
      dataType:'json',
      async: false,
      data: {user_id: id},     
      success:function(data){
       
      }
    });
}
        
        
 function showadd(data){
        var tm = '';
        filterName(data);
        num = data.length;
        for(var i =0; i<data.length; i++){
            if(data[i].is_here == 1){
                if(data[i].is_weibo == 1){
                     tm+='<tr class="success"><td>'+data[i].user_event_id +'</td><td>'+data[i].user_nickname+
					'</td><td><i class="icon-ok"></i>'+
						'</td><td><i class="icon-ok"></i></td>'+
					'</tr>';
                }else{
                    tm+='<tr class="success"><td>'+data[i].user_event_id+'</td><td>'+data[i].user_nickname+
					'</td><td><i class="icon-ok"></i>'+
						'</td><td><button class="btn btn-mini jin">否</button></td>'+
					'</tr>';
                }
            }else{
                 tm+='<tr><td>'+data[i].user_event_id+'</td><td>'+data[i].user_nickname+
					'</td><td><button class="btn btn-primary btn-mini">否</button>'+
						'</td><td><button class="btn btn-mini jin">否</button></td>'+
					'</tr>';
            }
        }
        
        $('#add_menu').html(tm);        
}
function filterName(data){
    for(var i =0; i<data.length; i++){
        if(data[i].user_nickname  == ''){
            data[i].user_nickname = data[i].weibo_nickname;
        }
    }
}
function filterName2(data){
    if(data.length == 0){
        return;
    }
    for(var i =0; i<data.length; i++){
        if(data[i].paiwo_user_nickname   == ''){
            data[i].paiwo_user_nickname  = data[i].weibo_nickname;
        }
    }
}
          
        
function showPrice(data){
    var tm = '';    
    if(luck_type == 1){
         tm +='<tr class="info"><td>'+data.user_id +'</td><td>'+data.paiwo_user_nickname +'</td><tr>';
        $('#prize_show').append(tm);
    }else if(luck_type == 2){
         tm +='<tr class="warning"><td>'+data.user_id +'</td><td>'+data.paiwo_user_nickname +'</td><tr>';
        $('#prize_show2').append(tm);
    }else{
    
    }
    
}        

function showHead(data){
    if(typeof data == undefined){
        $('#next').hide();
        return;
    }
    $('.film').remove();
    $('#photo_film').prepend('<div class="film"><div class="file_box">'+
            '<img src="http://image.paiwo.co/'+data.paiwo_user_avatar +'" class="avatar" />'+
            '<span class="name">'+data.paiwo_user_nickname+'</span>'+
            '<i class="number">编号'+data.user_id+'</i>'+
        '</div><img class="film_img" width="240" src="/static/images/film.png" alt=""></div>');
    setTimeout(function(){showPrice(data);},2500);
    
    if(pdata[index+1] == undefined){
       $('#next').hide();
    }
    
    
}        
        
    
    </script>
    
</body>
</html>