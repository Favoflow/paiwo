jQuery(function($){$(".search_footer").on("click",function(){if(watch_status==1){getFollows(++page_no)}else{getMore(++page_no)}});$(".search_pg_photobox").on("click",".photog_add",function(){if(is_login==0){showMessage("请先登录后，再关注摄影师");return}var id=this.getAttribute("data");doFollow(id)});$(".search_pg_photobox").on("click",".photog_added",function(){if(is_login==0){showMessage("请先登录后，再关注摄影师");return}var id=this.getAttribute("data");unFollow(id)});$(".search_photog").on("click",function(){watch_status=0;page_no=1;getMore(page_no);$(this).removeClass("dbcolor");$(".search_photog_follow").addClass("dbcolor")});$(".search_photog_follow").on("click",function(){if(is_login==0){showMessage("登录后获取关注列表");return}$(this).removeClass("dbcolor");$(".search_photog").addClass("dbcolor");watch_status=1;page_no=1;getFollows(page_no)});$(".search_pg_photobox").on("mouseenter",".photog_added",function(){$(this).find("i").html("取消")});$(".search_pg_photobox").on("mouseleave",".photog_added",function(){$(this).find("i").html("已关注")});init()});function init(){getMore(1);$(".navi_middle_activities p").removeClass();$(".navi_middle_Photographer p ").addClass("navi_middle_cur")};
var page_size=21;var page_no=1;var photog_count=0;var watch_status=0;var follow_count=0;function getMore(page_no){$.ajax({url:"/a/photographer/list/get",type:"POST",dataType:"json",data:{page_no:page_no,page_size:page_size},success:function(data){if(data.error_id==0){photog_count=data.result.count;var tm=$.tmpl(photog_tm,data.result.photographer_list);if(page_no==1){$(".search_pg_photobox").hide().html(tm).fadeIn(400)}else{$(".search_pg_photobox").append(tm)}checkMore()}else{showMessage("网络错误..")}}})}function doFollow(id){$.ajax({url:"/a/photographer/follow",type:"POST",dataType:"json",data:{photographer_id:id},success:function(data){if(data.error_id==0){var name=$(".photog_add[data="+id+"]").html("<i>已关注</i>").removeClass().addClass("photog_added").attr("xs");showMessage("添加关注 "+name+" 摄影师")}else{showMessage("网络错误..")}},error:function(){showMessage("网络错误..")}})}function unFollow(id){$.ajax({url:"/a/photographer/unfollow",type:"POST",dataType:"json",data:{photographer_id:id},success:function(data){if(data.error_id==0){var name=$(".photog_added[data="+id+"]").html("<i></i>").removeClass().addClass("photog_add").attr("xs");showMessage("取消关注 "+name+" 摄影师")}else{}},error:function(){showMessage("网络错误..")}})}function getFollowss(page_no){$.ajax({url:"/a/photographer/follow/list/get2",type:"POST",dataType:"json",data:{page_no:page_no,page_size:page_size},success:function(data){if(data.error_id==0){follow_count=data.result.count;var tm=$.tmpl(photog_tm,data.result.photographer_list);if(page_no==1){$(".search_pg_photobox").hide().html(tm).fadeIn(400)}else{$(".search_pg_photobox").append(tm)}checkMore()}else{showMessage("网络错误..")}}})}function getFollows(page_no){$.ajax({url:"/a/photographer/follow/list/get",type:"POST",dataType:"json",data:{page_no:page_no,page_size:page_size},success:function(data){if(data.error_id==0){photog_count=data.result.count;var tm=$.tmpl(photog_tm,data.result.photographer_list);if(page_no==1){$(".search_pg_photobox").hide().html(tm).fadeIn(400)}else{$(".search_pg_photobox").append(tm)
}checkMore()}else{showMessage("网络错误..")}}})}function checkMore(){if(watch_status==0){if(photog_count>page_no*page_size){$(".search_footer").show();return true}else{$(".search_footer").hide();return false}}else{if(follow_count>page_no*page_size){$(".search_footer").show();return true}else{$(".search_footer").hide();return false}}};
var photog_tm="<li>"+'<a class="search_pg_head_img" target="_blank" href="${user_host}">'+"{{if avatar == 0}}"+'<img src="static/images/user_head.gif" width="60" height="60">'+"{{else}}"+'<img src="http://image.paiwo.co/${avatar}" width="60" height="60">'+"{{/if}}"+"</a>"+"<dl>"+'<dt><a target="_blank" href="${user_host}">${filterChar(nick_name)}</a>'+"{{if gender == 1}}"+'<i class="photog-male"></i>'+"{{else}}"+'<i class="photog-fmale"></i>'+"{{/if}}"+"</dt>"+"<dd>相册<span>${album_count}</span></dd>"+"</dl>"+"{{if is_follow ==1}}"+'<a class="photog_added" data="${userid}" xs="${nick_name}">'+"<i>已关注</i></a>"+"{{else}}"+'<a class="photog_add" data="${userid}" xs="${nick_name}">'+"<i></i></a>"+"{{/if}}"+"</li>";
var set1=null;function showMessage(content){clearTimeout(set1);$(".message-box").html(content).animate({"top":"0px"},function(){set1=setTimeout(hideMessage,1500)})}function hideMessage(){$(".message-box").animate({"top":"-27px"})}function showAvatar(avatar){if(avatar==0){return""}else{return avatar}}function filterChar(str){var count=0;var tm="";if(str.length<6){return str}for(var i=0;i<str.length;i++){if(str.charCodeAt(i)>255){count+=14}else{count+=7.5}tm+=str[i];if(count>=84){return tm+=".."}}return tm};
