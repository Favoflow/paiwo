function getmessage(){$.ajax({url:"/a/user/top/get",type:"POST",dataType:"json",async:!1,success:messageresult})}function messageresult(e){if(0==e.error_id){if(top_data=e.result,is_login=e.result.is_login,0==is_login)return $(".navi_head_unlogin").show(),$(".top-tab-con>li").slice(3).show(),void $(".top-tab-con>li").slice(0,3).hide();$(".tab-icon").show(),my_avatar=e.result.avatar,$(".tab-icon1").first().hide(),""!=e.result.avatar&&0!=e.result.avatar?($(".navi_head_headed").attr("src","http://image.paiwo.co/"+e.result.avatar).show(),$(".tab-icon-userhead").attr("src","http://image.paiwo.co/"+e.result.avatar)):($(".navi_head_login").show(),$(".tab-icon-userhead").attr("src","/static/images/user_head.gif")),$("#top_message").show(),$(".user_name").text(filter(e.result.nick_name)),my_nickname=e.result.nick_name,$(".tab-icon_myset>p").html(my_nickname),0==e.result.is_photographer?($("#up_loadimg").hide(),$("#tab-bephotog").show(),$(".select_photog_infor").hide(),is_photographer=0):is_photographer=1,""!=e.result.user_host&&$(".select_browse").attr("href","/"+e.result.user_host),$("#nav").on("click",".navi_protrait",function(){$(this).attr("href","/setting")})}}function filter(e){if(e.length<5)return e;for(var o="",i=0,a=0;a<e.length;a++){if(i>8)return o+"..";e.charCodeAt(a)>255?i+=2:i++,o+=e[a]}return o}function scrollbarwidth(){var e=$('<div style="width:50px;height:50px;overflow:auto"><div></div></div>').appendTo("body"),o=e.children(),i=o.innerWidth()-o.height(99).innerWidth();return e.remove(),i}function searchModule(e){function o(o){var i=/\s/;if(!i.test(o)&&0!=o.length){var t=a(1,11),n=0;if(r==t){for(var l=[];0==l.length;){var t=a(1,11);t!=r&&l.push(t)}n=r=t=l[0]}else n=r=t;var c='<div class="search-color'+n+'"><span class="search_data">'+o+'</span><span class="search_ul_remove"><i></i></span></div>';$(e+" .searchlabels").append(c),s(e)}}function i(){$(e+" .searchlabels>div").last().remove()}function a(e,o){return parseInt(Math.random()*(o-e))+e}function s(e){var o=document.querySelector(e+" .searchlabels"),i=o.scrollWidth,a=$(e+" .tab_search_ul");i>=750?a.css("margin-left",-(i-650)):a.css("margin-left",0)}var t=$(e);t.on("click",".search_ul_remove",function(){$(this).parent().fadeOut(100,function(){$(this).remove(),s(e)})});var n=0;t.on("keydown",".search_input",function(o){var i=o.keyCode;8==i&&(n=0!=this.value.length?1:0,s(e)),13==i&&$(e+" .search-mag").trigger("click"),o.stopPropagation()}),t.on("keyup",".search_input",function(a){var t=a.keyCode;if(32==t||188==t||186==t){var r=this.value;if("-1"==r.indexOf(" "))return;s(e),o(r.substr(0,r.length-1)),this.value=""}8==t&&0==this.value.length&&0==n&&(i(),s(e)),a.stopPropagation()});var r=a(1,11),l="",c=$(e+" .search_input");c.on("focus",function(){$(this).attr("placeholder","")}),c.on("blur",function(){""==this.value&&0==$(e+" .search_data").length&&$(this).attr("placeholder","搜索你喜欢的")}),$(e+" .search-mag").on("click",function(o){return 0==$(e+" .search_data").length?""==c.val()?void(window.location="/search"):void(window.location="/search?q="+c.val()):($(e+" .search_data").each(function(e,o){0==e?l=o.innerHTML:l+=","+o.innerHTML}),""!=c.val()&&(l+=","+c.val()),window.location="/search?q="+l,void o.stopPropagation())}),".search-main"==e&&$(".search-key").on("click",".hot_tag",function(o){var i=$(this).html(),t=a(1,11),n=0;if(r==t){for(var l=[];0==l.length;){var t=a(1,11);t!=r&&l.push(t)}n=r=t=l[0]}else n=r=t;var c='<div class="search-color'+n+'"><span class="search_data">'+i+'</span><span class="search_ul_remove"><i></i></span></div>';return $(".search-main .search_input").attr("placeholder",""),$(".search-main .searchlabels").append(c),s(e),o.stopPropagation(),!1})}var navit=$(".navi_middle > a").not(".navi_button"),timer=null,timerOut=null,flag=!1,oBody=document.getElementsByTagName("body")[0],searchBtn=$(".tab-search"),searchBg=$(".search-back"),searchClose=$(".search-close"),searchMain=$(".search-main"),topBar=$(".top-tab"),goTop=$("#go_top"),searchBox=$(".tab_searchbox"),search={bOpen:!1,scrollWidth:scrollbarwidth(),openStyle:function(){search.bOpen=!0,searchBg.fadeIn(200),setTimeout(function(){searchMain.css({visibility:"visible"}).addClass("activeIn")},200),oBody.style.paddingRight=search.scrollWidth+"px",topBar.css({"padding-right":search.scrollWidth,left:-search.scrollWidth}),searchBox.css("margin-left",search.scrollWidth),oBody.style.overflow="hidden",goTop.hide()},closeStyle:function(){search.bOpen=!1,searchBg.fadeOut(200),searchMain.removeClass("activeIn").addClass("activeOut"),setTimeout(function(){searchMain.css({visibility:"hidden"}).removeClass("activeOut"),oBody.style.paddingRight="0px",oBody.style.overflowY="auto",topBar.css({"padding-right":0,left:0}),searchBox.css("margin-left",0),goTop.show(),$(".search-main .searchlabels").html("")},200)}};$(".tab-icon_myset").on("mouseenter",function(){$(this).find("i").addClass("select-arrow-active")}),$(".tab-icon_myset").on("mouseleave",function(){$(this).find("i").removeClass("select-arrow-active")}),navit.on("mouseenter","div",function(){$(this).find("span").css({color:"#fff"})}),navit.on("mouseleave","div",function(){$(this).find("span").css({color:"#b6b3ad"})}),$(".navi_middle_photos").on("mouseenter",function(){$(this).find("i").removeClass().addClass("middle_pics_i_hover")}),$(".navi_middle_photos").on("mouseleave",function(){$(this).find("i").removeClass().addClass("middle_pics_i")}),$(".navi_middle_Photographer").on("mouseenter",function(){$(this).find("i").removeClass().addClass("middle_Photographer_i_hover")}),$(".navi_middle_Photographer").on("mouseleave",function(){$(this).find("i").removeClass().addClass("middle_Photographer_i")}),$(".navi_middle_task").on("mouseenter",function(){$(this).find("i").removeClass().addClass("middle_task_i_hover")}),$(".navi_middle_task").on("mouseleave",function(){$(this).find("i").removeClass().addClass("middle_task_i")}),$(".navi_middle_activities").on("mouseenter",function(){$(this).find("i").removeClass().addClass("middle_activities_i_hover")}),$(".navi_middle_activities").on("mouseleave",function(){$(this).find("i").removeClass().addClass("middle_activities_i")}),$(".select_browse").on("click",function(){return 0==is_photographer?(showMessage("请先认证成为摄影师"),!1):void 0});var top_data,my_avatar=0,my_nickname=0,is_login=0,is_photographer=0;getmessage(),$("#tab-icon_myset").on("mouseenter",function(e){timer=setTimeout(function(){$(".tab_select_box").stop().animate({opacity:1,height:278},200,"linear")},100),e.stopPropagation()}),$(".select_login_out").on("mouseenter",function(){$(this).find("i").removeClass().addClass("select_login_ihover")}),$(".select_login_out").on("mouseleave",function(){$(this).find("i").removeClass().addClass("select_login_i")}),$("#tab-icon_myset").on("mouseleave",function(e){clearTimeout(timer),$(".tab_select_box").stop().animate({opacity:0,height:0},200,"linear"),e.stopPropagation()}),$(".push_button").on("click",function(){return flag?($(this).find("li").removeClass("active"),$("#main_box").removeClass("active"),$(this).removeClass("active"),$(".pointer_box").removeClass("active"),$("#shadow_box").css("visibility","hidden"),$(".top-tab").removeClass("active"),$(".back_color").removeClass("active"),$("#shadow_box").removeClass("active"),oBody.style.overflowY="auto",$(".go_top").show(),setTimeout(function(){$("#nav").hide(),$(".search-sim").css("display","block")},500),flag=!1):($(".navi-one,.navi-two,.navi-three").addClass("active"),$("#nav").show(),$("#main_box").addClass("active"),$(this).addClass("active"),$(".pointer_box").addClass("active"),$("#shadow_box").css("visibility","visible"),$(".top-tab").addClass("active"),$(".back_color").addClass("active"),$("#shadow_box").addClass("active"),$(".search-sim").hide(),oBody.style.overflowY="hidden",$(".go_top").hide(),flag=!0),!1}),$("#shadow_box").on("click",function(e){$(".navi-one,.navi-two,.navi-three").removeClass("active"),$("#main_box").removeClass("active"),$(".push_button").removeClass("active"),$(".pointer_box").removeClass("active"),$("#shadow_box").css("visibility","hidden"),$(".top-tab").removeClass("active"),$(".back_color").removeClass("active"),$("#shadow_box").removeClass("active"),oBody.style.overflowY="scroll",setTimeout(function(){$("#nav").hide(),$(".search-sim").fadeIn(300)},500),flag=!1,e.stopPropagation()}),searchBtn.on("click",function(){return search.bOpen?search.closeStyle():search.openStyle(),!1}),searchClose.on("click",function(){search.closeStyle(),$(".search-main .tab_search_ul").css("margin-left",0)}),searchBg.on("click",function(){search.closeStyle(),$(".search-main .tab_search_ul").css("margin-left",0)}),function(){function e(){$.ajax({url:"/a/search/hot_tag",type:"POST",dataType:"json",async:!1,success:function(e){if(0==e.error_id){for(var o=e.result.hot_tag_list,i="<dt>热门搜索：</dt>",a=0;a<o.length;a++)i+='<dd class="hot_tag">'+o[a]+"</dd>";$(".search-key dl").html(i)}}})}e(),searchModule(".search-main")}();var loginBox=$(".login_box");loginClose=$(".look_look"),loginModule=$(".login_module"),loginBg=$(".login_module .login_shadow"),scrollWidth=base.scrollbarwidth,_body=document.getElementsByTagName("body")[0],searchBox=$(".tab_searchbox"),goTop=$(".go_top"),topBar=$(".top-tab"),searchTop=$(".search-sim .search-word"),loginTop=$(".tab-login-a"),showPic=$(".black_bac");var loginInside={reg:{email:/^\w+((-w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/,pwd:/^[0-9a-zA-Z\,\.]{6,15}$/},isOpen:!1,goUrl:window.location.href,scrollWidth:base.scrollbarwidth(),show:function(){loginInside.isOpen=!0,loginModule.css("display","block"),loginBg.show(),_body.style.overflow="hidden",_body.style.paddingRight=loginInside.scrollWidth+"px",topBar.css({"padding-right":loginInside.scrollWidth,left:-loginInside.scrollWidth}),searchBox.css("margin-left",loginInside.scrollWidth),goTop.hide(),loginBox.css({visibility:"visible"}).addClass("activeIn")},hide:function(){loginInside.isOpen=!1,loginBox.removeClass("activeIn").addClass("activeOut"),loginBg.hide(),setTimeout(function(){loginBox.css({visibility:"hidden"}).removeClass("activeOut"),goTop.show(),("none"==showPic.css("display")||0==showPic.length)&&(_body.style.overflow="auto",_body.style.paddingRight="0px",searchBox.css("margin-left",0)),topBar.css({"padding-right":0,left:0}),loginModule.css("display","none")},500)},check_val:function(e,o){return"email"==o?loginInside.reg.email.test(e):(o="pwd")?loginInside.reg.pwd.test(e):!1},showError:function(e,o){var i=$(e);i.html(o).show(),i.next().show()},check:function(e){var o=document.getElementById("login_email"),i=document.getElementById("login_pwd"),a=o.value,s=i.value;return a?loginInside.check_val(a,"email")?s?loginInside.check_val(s,"pwd")?(a=a.toLocaleLowerCase(),s=$.md5("paiwo_"+s),$.ajax({url:"/a/login/dologin",type:"POST",dataType:"json",data:{email:a,password:s},success:function(o){if(0==o.error_id)window.location.href=e;else{if(100007!=o.error_id)return loginInside.showError("#login_error_pwd",o.error_code),!1;loginInside.showError("#login_error_email",o.error_code)}}}),!1):(loginInside.showError("#login_error_pwd","密码格式错误"),!1):void loginInside.showError("#login_error_pwd","请填写密码"):(loginInside.showError("#login_error_email","邮箱格式错误"),!1):void loginInside.showError("#login_error_email","请填写邮箱")}};!function(){loginTop.on("click",function(){loginInside.show()}),$(document).on("click",".photo_fixbox",function(){return!1}),loginClose.on("click",function(){loginInside.hide()}),loginBg.on("click",function(){loginInside.hide()}),$("#login_b").on("click",function(){return loginInside.check(loginInside.goUrl),!1}),$("#login_box").on("keydown",function(e){var o=e.keyCode;13==o&&loginInside.check(loginInside.goUrl)})}();
var photog_tm='<li><a class="search_pg_head_img" target="_blank" href="${user_host}">{{if avatar == 0}}<img src="static/images/user_head.gif" width="60" height="60">{{else}}<img src="http://image.paiwo.co/${avatar}" width="60" height="60">{{/if}}</a><dl><dt><a target="_blank" href="${user_host}">${filterChar(nick_name)}</a>{{if gender == 1}}<i class="photog-male"></i>{{else}}<i class="photog-fmale"></i>{{/if}}</dt><dd>相册<span>${album_count}</span></dd></dl>{{if is_follow ==1}}<a class="photog_added" data="${userid}" xs="${nick_name}"><i>已关注</i></a>{{else}}<a class="photog_add" data="${userid}" xs="${nick_name}"><i></i></a>{{/if}}</li>';
function showMessage(e){clearTimeout(set1),$(".message-box").html(e).animate({top:"0px"},function(){set1=setTimeout(hideMessage,1500)})}function hideMessage(){$(".message-box").animate({top:"-27px"})}function showAvatar(e){return 0==e?"":e}function filterChar(e){var t=0,n="";if(e.length<6)return e;for(var a=0;a<e.length;a++)if(t+=e.charCodeAt(a)>255?14:7.5,n+=e[a],t>=84)return n+="..";return n}var set1=null;
function getMore(o){$.ajax({url:"/a/photographer/list/get",type:"POST",dataType:"json",async:!1,data:{page_no:o,page_size:page_size},success:function(e){if(0==e.error_id){photog_count=e.result.count;var a=$.tmpl(photog_tm,e.result.photographer_list);1==o?$(".search_pg_photobox").hide().html(a).fadeIn(400):$(".search_pg_photobox").append(a),checkMore()}else showMessage("网络错误..")}})}function doFollow(o){$.ajax({url:"/a/photographer/follow",type:"POST",dataType:"json",data:{photographer_id:o},success:function(e){if(0==e.error_id){var a=$(".photog_add[data="+o+"]").html("<i>已关注</i>").removeClass().addClass("photog_added").attr("xs");showMessage("添加关注 "+a+" 摄影师")}else showMessage("网络错误..")},error:function(){showMessage("网络错误..")}})}function unFollow(o){$.ajax({url:"/a/photographer/unfollow",type:"POST",dataType:"json",data:{photographer_id:o},success:function(e){if(0==e.error_id){var a=$(".photog_added[data="+o+"]").html("<i></i>").removeClass().addClass("photog_add").attr("xs");showMessage("取消关注 "+a+" 摄影师")}},error:function(){showMessage("网络错误..")}})}function getFollowss(o){$.ajax({url:"/a/photographer/follow/list/get2",type:"POST",dataType:"json",data:{page_no:o,page_size:page_size},success:function(e){if(0==e.error_id){follow_count=e.result.count;var a=$.tmpl(photog_tm,e.result.photographer_list);1==o?$(".search_pg_photobox").hide().html(a).fadeIn(400):$(".search_pg_photobox").append(a),checkMore()}else showMessage("网络错误..")}})}function getFollows(o){$.ajax({url:"/a/photographer/follow/list/get",type:"POST",dataType:"json",data:{page_no:o,page_size:page_size},success:function(e){if(0==e.error_id){photog_count=e.result.count;var a=$.tmpl(photog_tm,e.result.photographer_list);1==o?$(".search_pg_photobox").hide().html(a).fadeIn(400):$(".search_pg_photobox").append(a),checkMore()}else showMessage("网络错误..")}})}function checkMore(){return 0==watch_status?photog_count>page_no*page_size?($(".search_footer").show(),!0):($(".search_footer").hide(),!1):follow_count>page_no*page_size?($(".search_footer").show(),!0):($(".search_footer").hide(),!1)}var page_size=20,page_no=1,photog_count=0,watch_status=0,follow_count=0;
function init(){getMore(1),1==is_login&&$(".search_photog_follow").trigger("click")}jQuery(function(o){o(".search_footer").on("click",function(){1==watch_status?getFollows(++page_no):getMore(++page_no)}),o(".search_pg_photobox").on("click",".photog_add",function(){if(0==is_login)return void showMessage("请先登录后，再关注摄影师");var o=this.getAttribute("data");doFollow(o)}),o(".search_pg_photobox").on("click",".photog_added",function(){if(0==is_login)return void showMessage("请先登录后，再关注摄影师");var o=this.getAttribute("data");unFollow(o)}),o(".search_photog").on("click",function(){watch_status=0,page_no=1,getMore(page_no),o(this).removeClass("dbcolor"),o(".search_photog_follow").addClass("dbcolor")}),o(".search_photog_follow").on("click",function(){return 0==is_login?void showMessage("登录后获取关注列表"):(o(this).removeClass("dbcolor"),o(".search_photog").addClass("dbcolor"),watch_status=1,page_no=1,void getFollows(page_no))}),o(".search_pg_photobox").on("mouseenter",".photog_added",function(){o(this).find("i").html("取消")}),o(".search_pg_photobox").on("mouseleave",".photog_added",function(){o(this).find("i").html("已关注")}),init()});