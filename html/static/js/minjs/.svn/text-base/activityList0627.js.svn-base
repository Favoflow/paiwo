var activelistBox=$(".active-list");var activity={listPage:1,init:function(){base.ajax({data:{"method":"paiwo.activity.activity_banner.get"},success:function(data){if(data.error_id==0){var response=data.response,bannerDom=$(".active-banner"),bannerInfo=response.activity_list[0];bannerDom.css("background",bannerInfo.activity_banner_big).attr("data-code",bannerInfo.activity_id);bannerDom.parents("a").attr("href",bannerInfo.activity_url)}},error:function(data){slideMessage("网络错误")}})},getList:function(page_no){base.ajax({data:{"method":"paiwo.activity.activity_list.get","page_no":page_no,"page_size":5},success:function(data){if(data.error_id==0){var response=data.response,listInfo=response.activity_list.reverse(),putListTm="",pageTm="",pageCount=Math.ceil(response.count/response.page_size);activity.pageCount=pageCount;console.log("in");if(pageCount==1){activelistBox.append('<div class="list-box active-list-box'+response.page_no+'"></div>');putListTm=$.tmpl(activity.list_tm,listInfo);activelistBox.find(".active-list-box"+response.page_no+"").html(putListTm)}else{for(var i=0;i<pageCount;i++){if(i==0){pageTm+='<a class="page-cur">'+(i+1)+"</a>"}else{pageTm+="<a>"+(i+1)+"</a>"}}activelistBox.find(".pagep-no").html(pageTm);activelistBox.find(".page").show();if(response.page_no==1){activelistBox.append('<div class="list-box active-list-box'+response.page_no+'"></div>')}else{activelistBox.append('<div class="list-box active-list-box'+response.page_no+'" style="display:none;"></div>')}putListTm=$.tmpl(activity.list_tm,listInfo);activelistBox.find(".active-list-box"+response.page_no+"").html(putListTm)}activelistBox.find(".page-no a").eq(page_no-1).addClass("loaded")}},error:function(data){slideMessage("网络错误")}})},putTime:function(start,end){var startTime=start.split(" ")[0].split("-"),endTime=end.split(" ")[0].split("-"),oDate=new Date();if(startTime[0]==oDate.getFullYear()){startTime.splice(0,1)}if(endTime[0]==oDate.getFullYear()){endTime.splice(0,1)}return startTime.join("/")+" - "+endTime.join("/")},putState:function(start,end){var startDate=start.split(" ")[0].split("-"),startTime=start.split(" ")[1].split(":"),endDate=end.split(" ")[0].split("-"),endTime=end.split(" ")[1].split(":"),nowTime=new Date().getTime(),setStartTime=new Date(),setEndTime=new Date();setStartTime.setFullYear(startDate[0],startDate[1]-1,startDate[2]);setStartTime.setHours(startTime[0],startTime[1],startTime[2],0);setEndTime.setFullYear(endDate[0],endDate[1]-1,endDate[2]);setEndTime.setHours(endTime[0],endTime[1],endTime[2]);setStartTime=setStartTime.getTime();setEndTime=setEndTime.getTime();return'<span class="studio-active-cond"></span>'},pageShow:function(page_no){activity.listPage=page_no;activelistBox.find(".page-no a").removeClass("page-cur");activelistBox.find(".page-no a").eq(page_no-1).addClass("page-cur");activelistBox.find(".list-box").hide();activelistBox.find(".active-list-box"+page_no).fadeIn(100)},list_tm:'<div class="studio-trend-area" data-code="${activity_id}">'+'<div class="studio-trend-active clearfix">'+'<a href="${activity_url}" target="_blank">'+'<div class="studio-active-img" style="background-image:url(${activity_banner})"></div>'+"</a>"+'<div class="studio-active-detail">'+"<h3>${activity_title}</h3>"+'<p class="studio-active-time">'+"<span>活动时间：</span>"+"<i>${activity.putTime(activity_start_date,activity_end_date)}</i>"+"</p>"+"{{html activity.putState(activity_start_date,activity_end_date)}}"+'<button class="submit studio-look"><a href="${activity_url}" target="_blank">去看看</a></button>'+"</div>"+"</div>"+"</div>"};activity.init();activity.getList(1);activelistBox.on("click",".page-pre",function(){activity.listPage--;if(activity.listPage==1){activity.listPage=1}activity.pageShow(activity.listPage);if(activelistBox.find(".page-no a").eq(activity.listPage-1).hasClass("loaded")){return}activity.getList(activity.listPage)});activelistBox.on("click",".page-next",function(){activity.listPage++;if(activity.listPage==activity.pageCount){activity.listPage=activity.pageCount}activity.pageShow(activity.listPage);if(activelistBox.find(".page-no a").eq(activity.listPage-1).hasClass("loaded")){return}activity.getList(activity.listPage)});activelistBox.on("click",".page-no a",function(){var $this=$(this),index=$this.html();activity.pageShow(index);if($this.hasClass("loaded")){return}activity.getList(index)});