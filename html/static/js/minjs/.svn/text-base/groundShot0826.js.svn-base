var alertBox=$(".setting_alert_shadow"),activeNow=$(".active_now"),activeSoon=$(".active_soon"),activeSuccess=$(".active_success"),activeLate=$(".active_late");var groupShot={};groupShot.getState=function(type,fn){var type=type?type:1;$.ajax({url:"/rest",type:"POST",dataType:"json",async:false,data:{data:JSON.stringify({"method":"paiwo.activity.group_shot.get"})},success:function(data){if(data.error_id==0){var response=data.response,state=response.activity_state,apply=response.apply_state,next=response.next_state;if(state==0){slideMessage("活动未开始")}else{if(state==2||state==3){activeLate.fadeIn()}else{if(state==1&&apply==1){activeSoon.fadeIn()}else{if(state==1&&apply==2){if(next==1){activeSuccess.find(".put-name").html(response.real_name);activeSuccess.find(".put-phone").html(response.phone);activeSuccess.find("h3").css("margin-top","0");activeSuccess.find(".alert_buttons_save").css("margin","60px auto 0");activeSuccess.find(".setting_alert_mes").show();activeSuccess.find(".alert_input_sign").show()}else{if(next==0){activeSuccess.find("h3").css("margin-top","30px");activeSuccess.find(".alert_buttons_save").css("margin","140px auto 0");activeSuccess.find(".setting_alert_mes").hide();activeSuccess.find(".alert_input_sign").hide()}}activeSuccess.fadeIn()}else{if(state==1&&apply==0){if(type==1){activeNow.fadeIn()}else{if(type==2){return fn()}}}}}}}}else{slideMessage("网络错误")}},error:function(data){slideMessage("网络错误")}})};groupShot.submitInfo=function(name,phone,state){console.log(name,phone,state);$.ajax({url:"/rest",type:"POST",dataType:"json",async:false,data:{data:JSON.stringify({"method":"paiwo.activity.group_shot.apply","real_name":name,"phone":phone,"next_state":state})},success:function(data){if(data.error_id==0){activeNow.fadeOut();activeSoon.fadeIn()}else{slideMessage("网络错误")}},error:function(data){slideMessage("网络错误")}})};groupShot.nameLenTest=function(data){var count=0;var reg=/[A-Za-z0-9]/;var reg2=/[\u4e00-\u9fa5]/;for(var i=0;i<data.length;i++){if(reg2.test(data[i])){count+=2}else{if(reg.test(data[i])){count+=1}else{return false}}}return count};groupShot.nameTest=function(val,_this){console.log("in "+val,_this);if(val==""){_this.find(".name-error-icon").show();_this.find(".name-error-wd").html("请填写姓名").show();return false}else{if(!groupShot.nameLenTest(val)){_this.find(".name-error-icon").show();_this.find(".name-error-wd").html("含有非法字符").show();return false}else{if(groupShot.nameLenTest(val)!=0&&groupShot.nameLenTest(val)>20){_this.find(".name-error-icon").show();_this.find(".name-error-wd").html("姓名长度过长").show();return false}else{_this.find(".name-error-icon").hide();_this.find(".name-error-wd").hide();return true}}}};groupShot.phoneTest=function(val,_this){if(val==""){_this.find(".phone-error-icon").show();_this.find(".phone-error-wd").html("请填写联系方式").show();return false}else{if(!/^1\d{10}$/.test(val)){_this.find(".phone-error-icon").show();_this.find(".phone-error-wd").html("手机格式错误").show();return false}else{_this.find(".phone-error-icon").hide();_this.find(".phone-error-wd").hide();return true}}};$(".group-shot-btn").on("click",function(){if(is_login==0){loginInside.show();return}groupShot.getState()});activeLate.on("blur",".name-input",function(){var val=this.value,$this=$(this).parents(".setting_alert_shadow");console.log(val,$this);groupShot.nameTest(val,$this)});activeLate.on("blur",".phone-input",function(){var val=this.value,$this=$(this).parents(".setting_alert_shadow");console.log(val,$this);groupShot.phoneTest(val,$this)});activeNow.on("click",".checkbox",function(){if(groupShot.replyAgain){activeNow.find(".right-icon").hide();groupShot.replyAgain=false}else{activeNow.find(".right-icon").show();groupShot.replyAgain=true}});activeNow.on("click",".alert_buttons_save",function(){var name=activeNow.find(".name-input").val().trim(),phone=activeNow.find(".phone-input").val().trim(),state=groupShot.replyAgain?1:0,$this=$(this).parents(".setting_alert_shadow");console.log("state "+state);if(groupShot.nameTest(name,$this)&&groupShot.phoneTest(phone,$this)){activeNow.hide();groupShot.getState(2,function(){groupShot.submitInfo(name,phone,state)})}});activeSuccess.on("click",".alert_buttons_save",function(){activeSuccess.fadeOut()});activeLate.on("click",".alert_buttons_save",function(){var name=activeLate.find(".name-input").val().trim(),phone=activeLate.find(".phone-input").val().trim(),state=1,$this=$(this).parents(".setting_alert_shadow");console.log("state "+state);if(groupShot.nameTest(name,$this)&&groupShot.phoneTest(phone,$this)){activeLate.hide();$.ajax({url:"/rest",type:"POST",dataType:"json",async:false,data:{data:JSON.stringify({"method":"paiwo.activity.group_shot.apply","real_name":name,"phone":phone,"next_state":state})},success:function(data){if(data.error_id==0){activeLate.find(".name-input").val("");activeLate.find(".phone-input").val("");activeLate.fadeOut()}else{slideMessage("网络错误")}},error:function(data){slideMessage("网络错误")}})}});alertBox.on("click",".setting_alert_close",function(ev){alertBox.find(".alert_repwd_inputs_i").hide();
alertBox.find(".alert_repwd_inputs_error").hide();alertBox.find("input").val("");$(this).parents(".setting_alert_shadow").fadeOut(200)});

