var base={scrollbarwidth:function(){if(document.documentElement.clientHeight<document.body.scrollHeight){var parent=$('<div style="width:50px;height:50px;overflow:auto"><div></div></div>').appendTo("body"),child=parent.children(),scrollbarwidth=child.innerWidth()-child.height(99).innerWidth();parent.remove();return scrollbarwidth}return 0},deviceRetina:function(num){if(arguments.length==0){return window.devicePixelRatio>1?true:false}if(window.devicePixelRatio>1){if(num=="1d5"){return"@!1d10"}else{if(num=="w280"){return"@!w560"}else{if(num=="w280h200"){return"@!560x400"}else{if(num=="a560"){return"@!1000x1000"}else{return"@!"+num*2+"x"+num*2}}}}}else{if(num=="1d5"){return"@!1d5"}else{if(num=="w280"){return"@!w280"}else{if(num=="w280h200"){return"@!280x200"}else{if(num=="a560"){return"@!560x560"}else{return"@!"+num+"x"+num}}}}}},retinaPixel:{},extend:function(target,source){var args=[].slice.call(arguments),i=1,key,ride=typeof args[args.length-1]=="boolean"?args.pop():true;if(args.length===1){target=!this.window?this:{};i=0}while((source=args[i++])){for(key in source){if(ride||(key in target)){target[key]=source[key]}}}return target},ajax:function(json){$.ajax({url:"/rest",type:"POST",dataType:"json",async:json.async?json.async:false,data:{data:JSON.stringify(json.data)},success:function(data){json.success&&json.success(data)},error:function(data){json.error&&json.error(data)}})}};base.renderTime=function(timestamp,l){if(l==0){timestamp=new Date(time).getTime();l==13}timestamp=(l==10)?timestamp*1000:timestamp;var now=new Date(),diff=now.getTime()-timestamp,last=new Date(timestamp),lastm="0"+last.getMinutes();var out="";if(diff<60000){out="刚刚"}else{if(diff>=60000&&diff<3600000){out=parseInt(diff/60000)+"分钟前"}else{if(diff>=3600000&&diff<21600000){out=parseInt(diff/3600000)+"小时前"}else{if(diff>=21600000&&diff<=86400000&&now.getDate()==last.getDate()){out="今天"+last.getHours()+":"+lastm.slice(-2)}else{if(diff>=21600000&&diff<=86400000+(23-last.getHours())*3600000){out="昨天"+last.getHours()+":"+lastm.slice(-2)}else{out=last.getFullYear()+"/"+(last.getMonth()+1)+"/"+last.getDate()}}}}}return out};base.retinaPixel["280"]=base.deviceRetina(280);base.retinaPixel["80"]=base.deviceRetina(80);base.retinaPixel["200"]=base.deviceRetina(200);base.retinaPixel["600"]=base.deviceRetina(600);base.retinaPixel["1d5"]=base.deviceRetina("1d5");base.retinaPixel["w280"]=base.deviceRetina("w280");base.retinaPixel["w280h200"]=base.deviceRetina("w280h200");base.retinaPixel["a560"]=base.deviceRetina("a560");base.retinaPixel["500"]=base.deviceRetina(500);(function(e){function o(){try{return r in e&&e[r]}catch(t){return !1}}var t={},n=e.document,r="localStorage",i="script",s;t.disabled=!1,t.version="1.3.17",t.set=function(e,t){},t.get=function(e,t){},t.has=function(e){return t.get(e)!==undefined},t.remove=function(e){},t.clear=function(){},t.transact=function(e,n,r){r==null&&(r=n,n=null),n==null&&(n={});var i=t.get(e,n);r(i),t.set(e,i)},t.getAll=function(){},t.forEach=function(){},t.serialize=function(e){return JSON.stringify(e)},t.deserialize=function(e){if(typeof e!="string"){return undefined}try{return JSON.parse(e)}catch(t){return e||undefined}};if(o()){s=e[r],t.set=function(e,n){return n===undefined?t.remove(e):(s.setItem(e,t.serialize(n)),n)},t.get=function(e,n){var r=t.deserialize(s.getItem(e));return r===undefined?n:r},t.remove=function(e){s.removeItem(e)},t.clear=function(){s.clear()},t.getAll=function(){var e={};return t.forEach(function(t,n){e[t]=n}),e},t.forEach=function(e){for(var n=0;n<s.length;n++){var r=s.key(n);e(r,t.get(r))}}}else{if(n.documentElement.addBehavior){var u,a;try{a=new ActiveXObject("htmlfile"),a.open(),a.write("<"+i+">document.w=window</"+i+'><iframe src="/favicon.ico"></iframe>'),a.close(),u=a.w.frames[0].document,s=u.createElement("div")}catch(f){s=n.createElement("div"),u=n.body}var l=function(e){return function(){var n=Array.prototype.slice.call(arguments,0);n.unshift(s),u.appendChild(s),s.addBehavior("#default#userData"),s.load(r);var i=e.apply(t,n);return u.removeChild(s),i}},c=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g");function h(e){return e.replace(/^d/,"___$&").replace(c,"___")}t.set=l(function(e,n,i){return n=h(n),i===undefined?t.remove(n):(e.setAttribute(n,t.serialize(i)),e.save(r),i)}),t.get=l(function(e,n,r){n=h(n);var i=t.deserialize(e.getAttribute(n));return i===undefined?r:i}),t.remove=l(function(e,t){t=h(t),e.removeAttribute(t),e.save(r)}),t.clear=l(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(r);for(var n=0,i;i=t[n];n++){e.removeAttribute(i.name)}e.save(r)}),t.getAll=function(e){var n={};return t.forEach(function(e,t){n[e]=t}),n},t.forEach=l(function(e,n){var r=e.XMLDocument.documentElement.attributes;for(var i=0,s;s=r[i];++i){n(s.name,t.deserialize(e.getAttribute(s.name)))}})}}try{var p="__storejs__";t.set(p,p),t.get(p)!=p&&(t.disabled=!0),t.remove(p)}catch(f){t.disabled=!0}t.enabled=!t.disabled,typeof module!="undefined"&&module.exports&&this.module!==module?module.exports=t:typeof define=="function"&&define.amd?define(t):e.store=t
})(Function("return this")());$(".tab-icon_myset").on("mouseenter",function(){$(this).find("i").addClass("select-arrow-active")});$(".tab-icon_myset").on("mouseleave",function(){$(this).find("i").removeClass("select-arrow-active")});$(".navi_middle_photos").on("mouseenter",function(){$(this).find("i").removeClass().addClass("middle_pics_i_hover")});$(".navi_middle_photos").on("mouseleave",function(){$(this).find("i").removeClass().addClass("middle_pics_i")});$(".navi_middle_Photographer").on("mouseenter",function(){$(this).find("i").removeClass().addClass("middle_Photographer_i_hover")});$(".navi_middle_Photographer").on("mouseleave",function(){$(this).find("i").removeClass().addClass("middle_Photographer_i")});$(".navi_middle_task").on("mouseenter",function(){$(this).find("i").removeClass().addClass("middle_task_i_hover")});$(".navi_middle_task").on("mouseleave",function(){$(this).find("i").removeClass().addClass("middle_task_i")});$(".navi_middle_activities").on("mouseenter",function(){$(this).find("i").removeClass().addClass("middle_activities_i_hover")});$(".navi_middle_activities").on("mouseleave",function(){$(this).find("i").removeClass().addClass("middle_activities_i")});$(".select_browse").on("click",function(){if(is_photographer==0){return false}});var timer1=null;timer2=null;$("#tab-icon_myset .tab-icon_myset").on("mouseenter",function(ev){clearTimeout(timer2);$(".tab_select_box").show();$(".tab_select_box").stop().animate({"opacity":1,"height":278},160,"linear");ev.stopPropagation()});$("#tab-icon_myset .tab-icon_myset").on("mouseleave",function(ev){timer1=setTimeout(function(){$(".tab_select_box").stop().animate({"opacity":0,"height":0},160,"linear",function(){$(".tab_select_box").hide()})},300);ev.stopPropagation()});$(".tab_select_box").on("mouseenter",function(){clearTimeout(timer1);$(".tab_select_box").stop().animate({"opacity":1,"height":278},160,"linear")});$(".tab_select_box").on("mouseleave",function(){timer2=setTimeout(function(){$(".tab_select_box").stop().animate({"opacity":0,"height":0},160,"linear",function(){$(".tab_select_box").hide()})},200)});var is_login=0;var cloud={init:function(fn){var initStr={url:"/rest",data:{data:JSON.stringify({method:"paiwo.user.top.get"})}};var iframe=document.createElement("iframe");iframe.src="http://paiwo.co/rest";iframe.style.display="none";iframe.setAttribute("id","main_frame");iframe.onload=function(){cloud.crossAjax(initStr,function(data){if(data.error_id==0){var _data=data.response;if(_data.is_login==0){is_login=0;$(".tab-login").show();$(".tab-regist").show();loginInside.show();return}else{is_login=1;$(".create-select").show();$("#tab-icon_myset").show();$("#top_message").show();$("#up_loadimg").show();$(".tab-login").hide();$(".tab-regist").hide()}if(_data.is_photographer==1){$(".tab-pc-change-select").show()}$(".tab-icon-userhead").attr("src","http://image.paiwo.co/"+_data.user_avatar);$(".tab-icon_myset p").html(_data.user_name)}fn&&fn()})};document.body.appendChild(iframe)},ajax:function(json){$.ajax({url:"/rest",type:"POST",dataType:"json",async:false,data:{data:JSON.stringify(json.data)},success:function(data){json.success&&json.success(data)},error:function(data){json.error&&json.error(data)}})},crossAjax:function(str,fn){var str=JSON.stringify(str),sendName=("message"+Math.random()).replace(".","");sendName=function(ev){var oEvent=ev||event;if(event.origin=="http://paiwo.co"){var _data=JSON.parse(oEvent.data);fn&&fn(_data);window.removeEventListener("message",sendName,false)}};window.addEventListener("message",sendName,false);var mainFrame=document.getElementById("main_frame").contentWindow;mainFrame.postMessage(str,"http://paiwo.co/rest")},hideScroll:function(){var scrollWidth=base.scrollbarwidth();$("html").css({"overflow-y":"hidden","padding-right":scrollWidth})},showScroll:function(){$("html").css({"overflow-y":"auto","padding-right":0})}};var loginBox=$(".login_box");loginClose=$(".look_look"),loginModule=$(".login_module"),loginBg=$(".login_module .login_shadow"),scrollWidth=base.scrollbarwidth,_body=document.getElementsByTagName("body")[0],searchBox=$(".tab_searchbox"),goTop=$(".go_top"),topBar=$(".top-tab"),searchTop=$(".search-sim .search-word"),loginTop=$(".tab-login-a"),showPic=$(".black_bac");var loginInside={reg:{email:/^\w+((-w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/,pwd:/^[0-9a-zA-Z\,\.]{6,15}$/},isOpen:false,goUrl:window.location.href,scrollWidth:base.scrollbarwidth(),show:function(){loginInside.isOpen=true;loginModule.css("display","block");loginBg.show();_body.style.overflow="hidden";_body.style.paddingRight=loginInside.scrollWidth+"px";topBar.css({"padding-right":loginInside.scrollWidth,"left":-loginInside.scrollWidth});searchBox.css("margin-left",loginInside.scrollWidth);goTop.hide();loginBox.css({"visibility":"visible"}).addClass("activeIn")},hide:function(){loginInside.isOpen=false;loginBox.removeClass("activeIn").addClass("activeOut");loginBg.hide();setTimeout(function(){loginBox.css({"visibility":"hidden"}).removeClass("activeOut");
if(document.documentElement.scrollTop||document.body.scrollTop!=0){goTop.show()}if(showPic.css("display")=="none"||showPic.length==0){_body.style.overflow="auto";_body.style.paddingRight="0px";searchBox.css("margin-left",0)}topBar.css({"padding-right":0,"left":0});loginModule.css("display","none")},500)},check_val:function(val,type){if(type=="email"){return loginInside.reg.email.test(val)}else{if(type="pwd"){return loginInside.reg.pwd.test(val)}else{return false}}},showError:function(target,content){var t=$(target);t.html(content).show();t.next().show()},check:function(fn){var l_email=document.getElementById("login_email");var l_pwd=document.getElementById("login_pwd");var email=l_email.value;var pwd=l_pwd.value;if(!email){loginInside.showError("#login_error_email","请填写邮箱");return}if(!loginInside.check_val(email,"email")){loginInside.showError("#login_error_email","邮箱格式错误");return false}if(!pwd){loginInside.showError("#login_error_pwd","请填写密码");return}if(!loginInside.check_val(pwd,"pwd")){loginInside.showError("#login_error_pwd","密码格式错误");return false}email=email.toLocaleLowerCase();pwd=$.md5("paiwo_"+pwd);cloud.crossAjax({url:"/rest",data:{data:JSON.stringify({email:email,password:pwd,method:"paiwo.account.login.email_login"})}},function(data){if(data.error_id==0){console.log("login");cloud.crossAjax({url:"/rest",data:{data:JSON.stringify({method:"paiwo.user.top.get"})}},function(data){if(data.error_id==0){var _data=data.response;top_info=_data;if(_data.is_login==0){is_login=0;$(".tab-login").show();$(".tab-regist").show();slideMessage("请先登录");return}else{is_login=1;if(window.location.href.toLowerCase().indexOf("bind")==-1){window.location.reload()}else{$("#tab-icon_myset").show();$("#top_message").show();$("#up_loadimg").show();$(".tab-login").hide();$(".tab-regist").hide();loginInside.hide()}}$(".tab-icon-userhead").attr("src","http://image.paiwo.co/"+_data.user_avatar);$(".tab-icon_myset p").html(_data.user_name);$(".bottom-tab").find(".customer-tab-logined").html('<img src="http://image.paiwo.co/'+_data.user_avatar+'" />'+_data.user_name+'<a class="delete-project" id="change-account">更换帐号</a>').show();$(".customer-tab-unlogin").hide();$(".bottom-tab").find(".cus-band-btn").show();fn&&fn(_data)}})}else{if(data.error_id==100007){loginInside.showError("#login_error_email",data.error_code);return false}else{loginInside.showError("#login_error_pwd",data.error_code);return false}}});return false}};(function(){loginTop.on("click",function(){loginInside.show()});$(document).on("click",".photo_fixbox",function(){return false});loginClose.on("click",function(){loginInside.hide()});loginBg.on("click",function(){loginInside.hide()});$("#login_box").on("keydown",function(ev){var keyCode=ev.keyCode;if(keyCode==13){loginInside.check(loginInside.goUrl)}})})();function clickLogin(){loginInside.check();return false}$("#login_b").on("click",clickLogin);$(".tab-login").on("click",function(){if(is_login==0){loginInside.show();return}});var mes=$(".setting_succeed");var setM=null;function slideMessage(str){clearTimeout(setM);mes.html(str).animate({top:0},400,function(){setM=setTimeout(hideMessage,1800)})}function hideMessage(){mes.animate({top:"-40px"},400)}function showMessage(str){slideMessage(str)}var tmp=null,tmpClass=null;$(".tab-pc-change-select").on("click",function(){if(!$(this).find("i").hasClass("select-arrow-active")){$(this).find("i").addClass("select-arrow-active");$(this).find("dl").stop().slideDown();tmp=$(this).find("span").html();tmpClass=$(this).find("span").attr("class")}else{$(this).find("i").removeClass("select-arrow-active");$(this).find("dl").stop().slideUp()}});$(".tab-pc-change-select").on("click","dl dd",function(){var $this=$(this),linkTo=$this.attr("class");if(linkTo=="cus"){window.location.href="/c";console.log("cus")}else{if(linkTo=="photog"){window.location.href="/p";console("photog")}}$(".tab-pc-change-select").find("span").html($this.html());$(".tab-pc-change-select").find("span").attr("class",$this.attr("class"));$this.html(tmp).attr("class",tmpClass);$(this).parent("dl").stop().slideUp()});cloud.init(function(){var oScript=document.createElement("script");oScript.src="/static/js/minjs/cloudMess0718.js";document.body.appendChild(oScript)});window.addEventListener("scroll",function(){var scrollTop=document.documentElement.scrollTop||document.body.scrollTop;if(scrollTop==0){$("#go_top").fadeOut()}else{$("#go_top").fadeIn()}},false);$("#go_top").on("click",function(){$("html,body").stop().animate({scrollTop:0},200)});var thirdLoginShadow=$(".third-login-shadow"),thirdLogin=$("#third-login-box");loginModule.on("click",".login_third_login li a",function(){console.log("good");thirdLogin.fadeIn();thirdLoginShadow.fadeIn()});thirdLogin.on("click",".submit",Relogin);function Relogin(){cloud.crossAjax({url:"/rest",data:{data:JSON.stringify({method:"paiwo.user.top.get"})}},function(data){if(data.error_id==0){window.location.reload()}else{slideMessage("您还未登录")}})}thirdLogin.on("click",".cancel,.message_close",function(){thirdLoginShadow.fadeOut()
});
