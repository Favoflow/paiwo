$(function(){FastClick.attach(document.body)});var base={ajax:function(t){$.ajax({url:"/rest",type:"POST",dataType:"json",async:t.async?t.async:!1,data:{data:JSON.stringify(t.data)},success:function(o){t.success&&t.success(o)},error:function(o){t.error&&t.error(o)}})},parseDom:function(t){var o=document.createElement("div");return o.innerHTML=t,o.childNodes[0].textContent},renderTime:function(t){var o=new Date,e=t.split(" "),i=e[0].split("-"),n=e[1].split(":");o.setFullYear(i[0],i[1]-1,i[2]),o.setHours(n[0],n[1],n[2],0);var a=o.getTime(),s=new Date,r=s.getTime(),c=r-a,p=[o.getFullYear(),o.getMonth(),o.getDate()],h=[s.getFullYear(),s.getMonth(),s.getDate()];if(6e4>c)return"刚刚";if(c>=6e4&&36e5>c){var u=parseInt(c/6e4);return u+"分钟前"}if(c>=36e5&&216e5>c){var u=parseInt(c/36e5);return u+"小时前"}if(c>=216e5&&p==h)return"今天"+o.getHours()+":"+o.getMinutes();if(c>=216e5&&p[0]==h[0]&&p[1]==h[1]&&h[2]-p[2]==1)return"昨天"+o.getHours()+":"+o.getMinutes();var d=o.getMonth()+1;return o.getFullYear()+"/"+d+"/"+o.getDate()}};$(function(){function t(){var t=document.documentElement.clientWidth,o=document.getElementsByTagName("html")[0],e=document.getElementsByTagName("body")[0];500>t?(t=parseInt(t/8),o.style.fontSize=t+"px",e.style.fontSize=t+"px"):t>=500&&(t=500,t=parseInt(t/8),o.style.fontSize=t+"px",e.style.fontSize=t+"px")}function o(){var t=$(".photos-list img").css("width");$(".photos-list img").css("height",t)}t(),o(),window.addEventListener("resize",function(){t(),o()},!1)}),$(function(){$(".column").tap(function(){$(".nav").animate({"-webkit-transform":"translate3d(0,100%,0)",transform:"translate3d(0,100%,0)",opacity:"1"},"cubic-bezier(0.1,0.57,0.1,1)",800,function(){$(".top-bar").css("display","none")})}),$(".shrink").tap(function(){$(".top-bar").css("display","block"),$(".nav").animate({"-webkit-transform":"translate3d(0,0,0)",transform:"translate3d(0,0,0)",opacity:"0"},"cubic-bezier(0.1,0.57,0.1,1)",800)})});var mainPic=$(".show_pic"),goPre=$(".big_pic_left"),goNext=$(".big_pic_right"),show_pic={photo_id:0,album_id:0,real_h:0,index:0,albumArr:[],get_host_name:function(){var t=window.location.href,o=t.lastIndexOf("/")+1;if(-1!=t.lastIndexOf("?")){var e=t.lastIndexOf("?");host_name=t.substring(o,e)}else host_name=t.substring(o);return host_name},get_img_h:function(){var t=$('<div class="photos-list"><img src="/static/phone/images/photo.jpg"><div class="photog_count"><span class="photo_author"></span></div></div>').appendTo(".like-photos .photos-main"),o=t.find("img").get(0).scrollWidth;return t.remove(),o},showLargePic:function(t){base.ajax({data:{method:"paiwo.content.photo.get",photo_id:t},success:function(t){if(console.log(t),0==t.error_id){var o=t.response,e=document.querySelector(".show_pic"),i=document.querySelector(".more_info_from"),n=document.querySelector(".author"),a=document.querySelector(".pic_ava"),s=document.querySelector(".pic_ava_link");e.setAttribute("src","http://image.paiwo.co/"+o.photo_path+"@!2d10"),$(".show_pic").css("display","none");var r=new Image;r.onload=function(){$(".big-loading").hide(),$(".show_pic").fadeIn(200)},s.href="/"+o.user_domain,r.src="http://image.paiwo.co/"+o.photo_path+"@!2d5",i.innerHTML=o.album_name,i.setAttribute("data-code",o.album_id),show_pic.album_id=o.album_id,n.innerHTML=o.user_name,n.setAttribute("data-code",o.user_id),a.src="http://image.paiwo.co/"+o.user_avatar,show_pic.albumList(o.album_photo_list),show_pic.index=show_pic.findIndex(show_pic.photo_id,show_pic.albumArr),0==show_pic.index?goPre.hide():show_pic.index==show_pic.albumArr.length-1&&goNext.hide(),show_pic.getRecommendList(o.album_id)}},error:function(t,o){}})},albumList:function(t){for(var o=0;o<t.length;o++)show_pic.albumArr.push(t[o].photo_id)},getRecommendList:function(t){base.ajax({data:{method:"paiwo.content.photo.recommend_list.get",album_id:t},success:function(t){if(0==t.error_id){var o=document.querySelector(".like-photos .photos-main"),e=t.response.photo_list,i="";if(e.length){for(var n=0;n<e.length;n++)i+='<div class="photos-list" data-code="'+e[n].photo_id+'"><a href="/photos/'+e[n].photo_id+'"><img height="" src="http://image.paiwo.co/'+e[n].photo_path+'@!400x400"></a></div>';o.innerHTML=i}else _like_head=document.querySelector(".may_like h2"),_like_head.style.display="none"}},error:function(t){}})},findIndex:function(t,o){for(var e=0;e<o.length;e++)if(t==o[e])return e;return 0},showIn:function(){goPre.animate({opacity:1},200),goNext.animate({opacity:1},200)},showOut:function(){goPre.animate({opacity:0},200),goNext.animate({opacity:0},200)}};mainPic.on("tap",function(t){console.log("111"),0==goPre.css("opacity")?show_pic.showIn():show_pic.showOut(),t.stopPropagation()}),goPre.on("tap",function(t){if(0==goPre.css("opacity")&&goPre.css("opacity",1),show_pic.index--,-1==show_pic.index)return void(show_pic.index=0);var o=show_pic.albumArr[show_pic.index];show_pic.showOut(),window.location.href="/photos/"+o,t.stopPropagation()}),goNext.on("tap",function(t){if(0==goNext.css("opacity")&&goNext.css("opacity",1),show_pic.index++,show_pic.index==show_pic.albumArr.length)return void(show_pic.index=show_pic.albumArr.length-1);var o=show_pic.albumArr[show_pic.index];show_pic.showOut(),window.location.href="/photos/"+o,t.stopPropagation()}),$(".big_pic_msg").on("tap",function(){window.location.href="/album/"+show_pic.album_id}),function(){show_pic.photo_id=parseInt(show_pic.get_host_name()),show_pic.real_h=show_pic.get_img_h(),show_pic.showLargePic(show_pic.photo_id)}();