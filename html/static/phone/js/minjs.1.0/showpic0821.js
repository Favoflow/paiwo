$(function(){function t(){var t=document.documentElement.clientWidth,e=document.getElementsByTagName("html")[0],o=document.getElementsByTagName("body")[0];500>t?(t=parseInt(t/8),e.style.fontSize=t+"px",o.style.fontSize=t+"px"):t>=500&&(t=500,t=parseInt(t/8),e.style.fontSize=t+"px",o.style.fontSize=t+"px")}function e(){var t=$(".photos-list img").css("width");$(".photos-list img").css("height",t)}t(),e(),window.addEventListener("resize",function(){t(),e()},!1)}),$(function(){$(".column").tap(function(){$(".nav").animate({"-webkit-transform":"translate3d(0,100%,0)",transform:"translate3d(0,100%,0)",opacity:"1"},"cubic-bezier(0.1,0.57,0.1,1)",800,function(){$(".top-bar").css("display","none")})}),$(".shrink").tap(function(){$(".top-bar").css("display","block"),$(".nav").animate({"-webkit-transform":"translate3d(0,0,0)",transform:"translate3d(0,0,0)",opacity:"0"},"cubic-bezier(0.1,0.57,0.1,1)",800)})});var base={ajax:function(t){$.ajax({url:"/rest",type:"POST",dataType:"json",async:t.async?t.async:!1,data:{data:JSON.stringify(t.data)},success:function(e){t.success&&t.success(e)},error:function(e){t.error&&t.error(e)}})},parseDom:function(t){var e=document.createElement("div");return e.innerHTML=t,e.childNodes[0].textContent},renderTime:function(t){var e=new Date,o=t.split(" "),i=o[0].split("-"),n=o[1].split(":");e.setFullYear(i[0],i[1]-1,i[2]),e.setHours(n[0],n[1],n[2],0);var a=e.getTime(),s=new Date,r=s.getTime(),c=r-a,p=[e.getFullYear(),e.getMonth(),e.getDate()],h=[s.getFullYear(),s.getMonth(),s.getDate()];if(6e4>c)return"刚刚";if(c>=6e4&&36e5>c){var u=parseInt(c/6e4);return u+"分钟前"}if(c>=36e5&&216e5>c){var u=parseInt(c/36e5);return u+"小时前"}if(c>=216e5&&p==h)return"今天"+e.getHours()+":"+e.getMinutes();if(c>=216e5&&p[0]==h[0]&&p[1]==h[1]&&h[2]-p[2]==1)return"昨天"+e.getHours()+":"+e.getMinutes();var d=e.getMonth()+1;return e.getFullYear()+"/"+d+"/"+e.getDate()}},mainPic=$(".show_pic"),goPre=$(".big_pic_left"),goNext=$(".big_pic_right"),show_pic={photo_id:0,album_id:0,real_h:0,index:0,albumArr:[],get_host_name:function(){var t=window.location.href,e=t.lastIndexOf("/")+1;if(-1!=t.lastIndexOf("?")){var o=t.lastIndexOf("?");host_name=t.substring(e,o)}else host_name=t.substring(e);return host_name},get_img_h:function(){var t=$('<div class="photos-list"><img src="/static/phone/images/photo.jpg"><div class="photog_count"><span class="photo_author"></span></div></div>').appendTo(".like-photos .photos-main"),e=t.find("img").get(0).scrollWidth;return t.remove(),e},showLargePic:function(t){base.ajax({data:{method:"paiwo.content.photo.get",photo_id:t},success:function(t){if(console.log(t),0==t.error_id){var e=t.response,o=document.querySelector(".show_pic"),i=document.querySelector(".more_info_from"),n=document.querySelector(".author"),a=document.querySelector(".pic_ava"),s=document.querySelector(".pic_ava_link");o.setAttribute("src","http://image.paiwo.co/"+e.photo_path+"@!2d10"),$(".show_pic").css("display","none");var r=new Image;r.onload=function(){$(".big-loading").hide(),$(".show_pic").fadeIn(200)},s.href="/"+e.user_domain,r.src="http://image.paiwo.co/"+e.photo_path+"@!2d5",i.innerHTML=e.album_name,i.setAttribute("data-code",e.album_id),show_pic.album_id=e.album_id,n.innerHTML=e.user_name,n.setAttribute("data-code",e.user_id),a.src="http://image.paiwo.co/"+e.user_avatar,show_pic.albumList(e.album_photo_list),show_pic.index=show_pic.findIndex(show_pic.photo_id,show_pic.albumArr),0==show_pic.index?goPre.hide():show_pic.index==show_pic.albumArr.length-1&&goNext.hide(),show_pic.getRecommendList(e.album_id)}},error:function(t,e){}})},albumList:function(t){for(var e=0;e<t.length;e++)show_pic.albumArr.push(t[e].photo_id)},getRecommendList:function(t){base.ajax({data:{method:"paiwo.content.photo.recommend_list.get",album_id:t},success:function(t){if(0==t.error_id){var e=document.querySelector(".like-photos .photos-main"),o=t.response.photo_list,i="";if(o.length){for(var n=0;n<o.length;n++)i+='<div class="photos-list" data-code="'+o[n].photo_id+'"><a href="/photos/'+o[n].photo_id+'"><img height="" src="http://image.paiwo.co/'+o[n].photo_path+'@!400x400"></a></div>';e.innerHTML=i}else _like_head=document.querySelector(".may_like h2"),_like_head.style.display="none"}},error:function(t){}})},findIndex:function(t,e){for(var o=0;o<e.length;o++)if(t==e[o])return o;return 0},showIn:function(){goPre.animate({opacity:1},200),goNext.animate({opacity:1},200)},showOut:function(){goPre.animate({opacity:0},200),goNext.animate({opacity:0},200)}};mainPic.on("tap",function(t){console.log("111"),0==goPre.css("opacity")?show_pic.showIn():show_pic.showOut(),t.stopPropagation()}),goPre.on("tap",function(t){if(0==goPre.css("opacity")&&goPre.css("opacity",1),show_pic.index--,-1==show_pic.index)return void(show_pic.index=0);var e=show_pic.albumArr[show_pic.index];show_pic.showOut(),window.location.href="/photos/"+e,t.stopPropagation()}),goNext.on("tap",function(t){if(0==goNext.css("opacity")&&goNext.css("opacity",1),show_pic.index++,show_pic.index==show_pic.albumArr.length)return void(show_pic.index=show_pic.albumArr.length-1);var e=show_pic.albumArr[show_pic.index];show_pic.showOut(),window.location.href="/photos/"+e,t.stopPropagation()}),$(".big_pic_msg").on("tap",function(){window.location.href="/album/"+show_pic.album_id}),function(){show_pic.photo_id=parseInt(show_pic.get_host_name()),show_pic.real_h=show_pic.get_img_h(),show_pic.showLargePic(show_pic.photo_id)}();