$(function(){$(".column").tap(function(){$(".nav").animate({"-webkit-transform":"translate3d(0,100%,0)","transform":"translate3d(0,100%,0)","opacity":"1"},"cubic-bezier(0.1,0.57,0.1,1)",800,function(){$(".top-bar").css("display","none")})});$(".shrink").tap(function(){$(".top-bar").css("display","block");$(".nav").animate({"-webkit-transform":"translate3d(0,0,0)","transform":"translate3d(0,0,0)","opacity":"0"},"cubic-bezier(0.1,0.57,0.1,1)",800)})});var base={ajax:function(json){$.ajax({url:"/rest",type:"POST",dataType:"json",async:json.async?json.async:false,data:{data:JSON.stringify(json.data)},success:function(data){json.success&&json.success(data)},error:function(data){json.error&&json.error(data)}})}};var mainPic=$(".show_pic"),goPre=$(".big_pic_left"),goNext=$(".big_pic_right");var show_pic={photo_id:0,album_id:0,real_h:0,index:0,albumArr:[],get_host_name:function(){var url=window.location.href;var index=url.lastIndexOf("/")+1;if(url.lastIndexOf("?")!=-1){var end=url.lastIndexOf("?");host_name=url.substring(index,end)}else{host_name=url.substring(index)}return host_name},get_img_h:function(){var parent=$('<div class="photos-list"><img src="/static/phone/images/photo.jpg"><div class="photog_count"><span class="photo_author"></span></div></div>').appendTo(".like-photos .photos-main");var _height=parent.find("img").get(0).scrollWidth;parent.remove();return _height},showLargePic:function(id){base.ajax({data:{"method":"paiwo.content.photo.get","photo_id":id},success:function(data){console.log(data);if(data.error_id==0){var photo_info=data.response;var main_photo=document.querySelector(".show_pic"),_album=document.querySelector(".more_info_from"),_author=document.querySelector(".author");main_photo.setAttribute("src","http://image.paiwo.co/"+photo_info.photo_path+"@!2d10");$(".show_pic").css("display","none");var oImg=new Image();oImg.onload=function(){$(".big-loading").hide();$(".show_pic").fadeIn(200)};oImg.src="http://image.paiwo.co/"+photo_info.photo_path+"@!2d5";_album.innerHTML=photo_info.album_name;_album.setAttribute("data-code",photo_info.album_id);show_pic.album_id=photo_info.album_id;_author.innerHTML=photo_info.user_name;_author.setAttribute("data-code",photo_info.user_id);show_pic.albumList(photo_info.album_photo_list);show_pic.index=show_pic.findIndex(show_pic.photo_id,show_pic.albumArr);if(show_pic.index==0){goPre.hide()}else{if(show_pic.index==show_pic.albumArr.length-1){goNext.hide()}}show_pic.getRecommendList(photo_info.album_id)}else{}},error:function(xhr,type){}})},albumList:function(list){for(var i=0;i<list.length;i++){show_pic.albumArr.push(list[i].photo_id)}},getRecommendList:function(id){base.ajax({data:{"method":"paiwo.content.photo.recommend_list.get","album_id":id},success:function(data){if(data.error_id==0){var _recommend=document.querySelector(".like-photos .photos-main"),recommend_list=data.response.photo_list,rec_str="";if(recommend_list.length){for(var i=0;i<recommend_list.length;i++){rec_str+='<div class="photos-list" data-code="'+recommend_list[i].photo_id+'"><a href="/photos/'+recommend_list[i].photo_id+'">'+'<img height="" src="http://image.paiwo.co/'+recommend_list[i].photo_path+'@!400x400"></a>'+"</div>"}_recommend.innerHTML=rec_str}else{_like_head=document.querySelector(".may_like h2");_like_head.style.display="none"}}},error:function(data){}})},findIndex:function(id,arr){for(var i=0;i<arr.length;i++){if(id==arr[i]){return i}}return 0},showIn:function(){goPre.animate({"opacity":1},200);goNext.animate({"opacity":1},200)},showOut:function(){goPre.animate({"opacity":0},200);goNext.animate({"opacity":0},200)}};mainPic.on("tap",function(ev){if(goPre.css("opacity")==0){show_pic.showIn()}else{show_pic.showOut()}ev.stopPropagation()});goPre.on("tap",function(ev){if(goPre.css("opacity")==0){goPre.css("opacity",1)}show_pic.index--;if(show_pic.index==-1){show_pic.index=0;return}var preId=show_pic.albumArr[show_pic.index];show_pic.showOut();window.location.href="/photos/"+preId;ev.stopPropagation()});goNext.on("tap",function(ev){if(goNext.css("opacity")==0){goNext.css("opacity",1)}show_pic.index++;if(show_pic.index==show_pic.albumArr.length){show_pic.index=show_pic.albumArr.length-1;return}var nextId=show_pic.albumArr[show_pic.index];show_pic.showOut();window.location.href="/photos/"+nextId;ev.stopPropagation()});$(".more_info_main").on("tap",function(){$(this).css("background-color","#eee");$(this).animate({"background-color":"#fff"},60);window.location.href="/album/"+show_pic.album_id});(function(){show_pic.photo_id=parseInt(show_pic.get_host_name());show_pic.real_h=show_pic.get_img_h();show_pic.showLargePic(show_pic.photo_id)})();